# 关系数据库设计

前面的章节介绍了数据库设计的基本步骤，从需求分析到概念模型设计的过程以及文档数据库的结构设计。本章主要介绍关系数据库的结构设计。


## 设计规则

与文档数据库不同，关系数据库不支持数组和表嵌套的形式，无法实现将多个数据实体转换成一个关系表和将多对多联系合并到任意一端的关系表中。文档数据库的模式设计规则并不适用于关系数据库。关系数据库的模式设计规则是怎样的呢？关系数据库的结构设计是将ERD概念模型中的实体、实体间的联系转换为关系模式，并确定这些关系模式的属性和主码。

<center>
	<img src="fig/ch5.1-E-Rforemployee.jpg" width="85%" alt="E-R" />
	<br>
	<div display: inline-block; padding : 2px>
		图 R5.1 员工与项目ERD概念模型
	</div>
</center>

关系模式的设计规则有：

* 实体转换规则：一个实体转换为一个关系模式（二维表）。如图R5.1中的员工实体转换为一个员工表（employee），项目实体转换为一个项目表（project）。
* 属性转换规则一：一个实体的唯一属性和单值属性构成该关系模式的属性，其中唯一属性是关系模式的主码。图5.1中员工的唯一属性工号和单值属性名字转换为员工表的属性，员工表的结构为：employee(<u>sno</u>,sname),其中带有下划线的属性为主码，图5.1中项目的项目号和经费转换为项目表的属性，项目表的结构为：project(<u>pno</u>,funds)。
* 属性转换规则二：一个实体的多值属性转换成一个关系模式，实体的唯一属性和多值属性是该关系模式的属性，也是关系模式的主码。图5.1中员工的多值属性技能转换为技能表，技能表中包含工号和技能两个属性，技能表的结构为：employeeskill(<u>sno,skill</u>)，其中工号和技能为技能表的主码。
* 联系转换规则：（1）实体之间的1:1联系与任意一端的关系模式合并，合并端的关系模式中需要加入联系自身的属性和另一端关系模式的主码属性；（2）实体之间的1:n联系与n端的关系模式合并，n端的关系模式中加入联系自身属性和另一端模式的主码属性；（3）实体之间的m:n联系转换为一个关系模式，联系自身属性以及联系两端实体的唯一属性组成该关系模式的属性。图5.1中的员工与项目之间m:n的参与联系转换为一个工作表work，表中包含员工号、项目号以及工时三个属性，工作表的结构为：work(<u>sno,pno</u>,working-hours)，其中员工号和项目号为主码。

## 关系结构设计



<center>
	<img src="fig/chD5.1-E-Rshopping.jpg" width="85%" alt="E-R" />
	<br>
	<div display: inline-block; padding : 2px>
		图 R5.1 购物网站ERD概念模型
	</div>
</center>

基于以上的规则，我们对本书前面章节提到的购物网站进行关系结构设计，可以得到5个关系模式：

```SQL
购物网站的关系模式设计：
用户表：User(Uid, Uname, Uadd, Tel), Uid是主码;
商品表：Product(Pid, Pname, Category, Price, Padd)，Pid是主码;
订单表：Order(Oid, Uid, Date)，OId是主码；
用户喜好表：Preference(Uid, Pref), Uid和Pref是主码；
订单详情表：OrderLine(Oid, Pid, Quantity), Oid和Pid是主码；
```

* 首先，图5.1中每类实体对象转换为一个关系模式，实体对象的唯一性属性和单值属性构成关系模式的属性，并将唯一性属性设置为关系模式的主码，则生成用户表User(<u>Uid</u>, Uname, Uadd, Tel)、商品表Product(<u>Pid</u>, Pname, Category, Price, Padd)和订单表Order(<u>Oid</u>, Date)，其中带下划线的属性为主码；
* 然后，用户实体对象的多值属性喜好转换为一个关系模式，用户的唯一性属性和多值属性构成关系模式的属性，则有用户喜好表Preference(<u>Uid, Pref</u>)，其中用户号Uid是用户喜好表的主码；
* 其次，用户和订单之间的一对多联系合并到订单表中，将用户的唯一性属性添加到订单表中，则生成订单表Order(<u>Oid</u>, Uid, Date)，其中订单号Oid为主码；
* 最后，订单和商品之间的多对多联系转换为一个关系模式，订单的唯一属性、商品的唯一属性和联系的自身属性构成该关系模式的属性，则有订单详情表OrderLine(<u>Oid, Pid</u>, Quantity)，其中订单号Oid、商品号Pid共同构成主码。









