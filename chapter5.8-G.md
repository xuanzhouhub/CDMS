# 图数据库设计

图数据库采用图结构表示现实世界中的实体和关系。图数据库模式由节点、边与属性构成：节点表示现实世界中的实体，对应ERD概念模型中的实体。节点具有标签（名称）和属性，其中一个属性为唯一属性，作为该节点的唯一标识。边表示两个节点之间的关系，对应ERD概念模型中的关系。边具有方向，即它有起始节点和终止节点。边也具有属性但不具有唯一属性，其起始节点和终止节点可作为唯一标识。本章节以属性图模型为例，介绍图数据库的设计。
<!-- 其设计思想与基于实体、属性和关系建模的ERD概念模型一致。因此，相比关系数据库与文档数据库的模式设计，ERD概念模型能够以更原生的方式转换为图数据库的数据模型。 -->


## 设计规则

<!-- 图数据库模式包含节点、边与属性：
- **节点**。与ERD概念模型类似，图数据库中的节点表示现实世界中的实体。节点具有标签（名称）和属性，其中一个属性为关键属性，作为该节点的唯一标识。
- **边**。边表示两个节点之间的关系，即ERD概念模型中的关系。边有方向，即它有起始节点和终止节点。边也具有属性。边有一个名称但不必是唯一的，因为它可以通过其起始节点和终止节点来识别。
例如，对于电影中的边名称演员，起始节点是电影，终止节点是演员。属性是角色（使演员能够在一部电影中扮演多个角色）。我们也可以以相反的方向定义起始节点和终止节点；这实际上并不重要，因为无论在哪个方向上，图形数据库系统都能够回答给定的请求，可能通过提出略有不同的查询。边用一条线表示，箭头从起始节点指向终止节点。边名称写在箭头上方或附近。
- **属性。** 如前所述，节点和边都可以具有属性。属性可能有约束: -->

ERD概念模型包含一组具有属性的实体，这些实体通常表示真实世界中的对象，并描述实体之间的联系。通常而言，任何ERD概念模型都存在一个对应的属性图模式。实体和关系可以分别映射为属性图模型中的顶点类型和边类型，节点和关系属性分别存储实体和关系的属性。然而，某些ERD概念模型可能包含无法直接映射到图数据模型的结构。例如，ERD概念模型可能包含多元关系，而属性图模式仅支持节点和二元边。因此，在将ERD概念模型转换为图数据库模式时，需要先将原始ERD模型中的多元关系转换为二元关系。

我们以图5.2中的用户、运营商和手机之间1:1:n的三元关系为例，展示ERD概念模型的多元关系调整方式。我们将该三元关系“使用”映射到一个弱实体，并将该弱实体与各相关实体建立二元关系。弱实体名
称可与原三元关系相同，或由相关实体的名称组成而成，在该例子中我们将其命名为“使用”实体。如果关系具有属性，则将这些属性添加到弱实体中，如“使用”的时间属性等。
对于更为复杂的ERD概念模型的结构，如父类-子类的ISA联系等，本书不再对其调整方法进行详细讨论。

将调整过的ERD概念模型映射为图数据库模式包含以下设计规则：
- 实体转换规则。一个实体转换为一个节点。如5.1中的员工实体映射为一个员工节点（employee），项目实体转换为项目节点（project）。
- 属性转换规则。将ERD概念模型中实体的属性转换为节点的属性。例如，图5.1中的员工实体的属性有员工编号、姓名、性别、年龄等，这些属性映射为员工节点的属性。而对于多值属性，则将其转换为新节点，并建立二元关系。具体来说，多值属性的具体值成为新节点的属性。例如，图5.1中员工的“技能”多值属性技能转换为“技能”节点，该节点包含“技能”属性，并与对应员工建立“具有”关系。
- 联系转换规则。实体之间的每个联系都映射到连接相应节点的边。边的名称可以是关系的名称，或基于所连接节点的角色命名。与 ERD 概念模型不同，在图数据库中，边是有向的，因此需要区分每条边的起始节点和终止节点。例如，对于员工和项目之间的关系，有两种关系映射方式：员工工作于项目（即，起始节点为员工，终止节点为项目，关系名称为“工作”）和项目雇佣员工（起始节点为项目，终止节点为员工，关系名称为“雇佣”）。
<!-- 在图 2 中，节点的属性写在节点矩形的底部，从（带下划线的）键属性开始。如果存在边的属性，则将其写在边名称后的括号中。如果存在属性的约束，则将其写在属性名称后。 -->
<!-- 将ERD概念模型转换为图数据库模型包含两个步骤：调整ERD以适配图数据库模型；将调整后的ERD转换为图数据库模型。
 -->

## 图结构设计
基于以上的规则，我们对图5.3(b)的购物网站ERD概念模型进行图结构设计。
<!-- ```SQL
购物网站的关系模式设计：
用户节点: User(Uid, Uname, Uadd, Tel),
下单: 
商品节点: Product(Pid, Pname, Category, Price, Padd)
订单详情节点: OrderLine(Quantity)
``` -->